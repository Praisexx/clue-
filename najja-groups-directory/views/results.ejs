<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
</head>
<body>
    <%- include('partials/header') %>

    <main class="container">
        <!-- Results Header -->
        <section class="section">
            <div class="text-center mb-8">
                <% if (typeof nearMe !== 'undefined' && nearMe) { %>
                    <h1 class="text-title mb-4">üìç Groups Near You</h1>
                    <p class="text-subtitle">Found <%= resultsCount || results.length %> group<%= (resultsCount || results.length) === 1 ? '' : 's' %> within 25km of your location</p>
                <% } else if (typeof query !== 'undefined' && query) { %>
                    <h1 class="text-title mb-4">Search Results</h1>
                    <p class="text-subtitle">Found <%= resultsCount || results.length %> group<%= (resultsCount || results.length) === 1 ? '' : 's' %> for "<%= query %>"</p>
                <% } else if (typeof category !== 'undefined' && category) { %>
                    <h1 class="text-title mb-4">üè∑Ô∏è <%= category.charAt(0).toUpperCase() + category.slice(1) %> Groups</h1>
                    <p class="text-subtitle">Found <%= resultsCount || results.length %> <%= category %> group<%= (resultsCount || results.length) === 1 ? '' : 's' %></p>
                <% } else { %>
                    <h1 class="text-title mb-4">All Groups</h1>
                    <p class="text-subtitle"><%= resultsCount || results.length %> group<%= (resultsCount || results.length) === 1 ? '' : 's' %> available</p>
                <% } %>
                
                <!-- Quick Actions -->
                <div class="results-actions mt-6">
                    <a href="/search" class="btn btn--outline">
                        üîç New Search
                    </a>
                    <% if (typeof category !== 'undefined' && category) { %>
                        <a href="/search" class="btn btn--outline">
                            ‚úï Clear Filter
                        </a>
                    <% } %>
                </div>
                
            </div>
            
        </section>

        <!-- Results Section -->
        <section class="section">
            <% if (typeof results !== 'undefined' && results.length > 0) { %>
                <div class="card-grid-modern">
                    <% results.forEach(function(group, index) { %>
                        <div class="card group-card hover-lift fade-in">
                            <div class="card__body">
                                <div class="flex items-center gap-4 mb-4">
                                    <div class="group-card__logo">
                                        <% 
                                        // Use realistic stock photos from Unsplash
                                        var logoNum = ((parseInt(group.id) % 5) + 1);
                                        var logoPath;
                                        
                                        if (group.name && (group.name.includes('Church') || group.name.includes('Christian') || group.name.includes('Christ') || group.name.includes('Redeemed') || group.name.includes('Living Faith') || group.name.includes('Mountain of Fire'))) {
                                            // Church photos - spiritual/architectural themes
                                            var churchPhotos = [
                                                'https://picsum.photos/id/75/400/400',   // Architecture/building
                                                'https://picsum.photos/id/582/400/400',  // Interior/peaceful
                                                'https://picsum.photos/id/665/400/400',  // Light/spiritual
                                                'https://picsum.photos/id/127/400/400',  // Gothic architecture
                                                'https://picsum.photos/id/250/400/400'   // Serene/contemplative
                                            ];
                                            logoPath = churchPhotos[logoNum - 1];
                                        } else if (group.name && (group.name.includes('University') || group.name.includes('Alumni') || group.name.includes('College') || group.name.includes('School'))) {
                                            // School photos - educational/academic themes
                                            var schoolPhotos = [
                                                'https://picsum.photos/id/159/400/400',  // Books/study
                                                'https://picsum.photos/id/175/400/400',  // Library/learning
                                                'https://picsum.photos/id/324/400/400',  // Academic building
                                                'https://picsum.photos/id/590/400/400',  // Graduation/achievement
                                                'https://picsum.photos/id/1/400/400'     // Classic academic
                                            ];
                                            logoPath = schoolPhotos[logoNum - 1];
                                        } else {
                                            // Organization photos - community/business themes
                                            var orgPhotos = [
                                                'https://picsum.photos/id/3/400/400',    // Professional/business
                                                'https://picsum.photos/id/7/400/400',    // Group/community
                                                'https://picsum.photos/id/15/400/400',   // Collaboration
                                                'https://picsum.photos/id/25/400/400',   // Modern/corporate
                                                'https://picsum.photos/id/29/400/400'    // People/networking
                                            ];
                                            logoPath = orgPhotos[logoNum - 1];
                                        }
                                        %>
                                        <img src="<%= logoPath %>" alt="<%= group.name %> logo" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                        <div style="width: 60px; height: 60px; border-radius: 8px; background: var(--gradient-accent); display: none; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2rem;">
                                            <%= group.name ? group.name.charAt(0).toUpperCase() : 'G' %>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="status-dot status-dot--active"></span>
                                            <span class="chip chip--success">Active</span>
                                            <% if (group.featured) { %>
                                                <span class="chip chip--success">‚ú® Featured</span>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                                
                                <h3 class="group-card__title"><%= group.name %></h3>
                                <p class="group-card__description">
                                    <%= group.description ? group.description.substring(0, 120) + '...' : 'No description available.' %>
                                </p>
                                
                                <div class="group-card__tags">
                                    <% if (group.distance !== null && group.distance !== undefined) { %>
                                        <span class="chip chip--success">üìè <%= group.distance %> km away</span>
                                    <% } else if (group.city || group.country) { %>
                                        <span class="chip">üìç <%= group.city || group.country %></span>
                                    <% } %>
                                    <% if (group.categories && group.categories.length > 0) { %>
                                        <span class="chip chip--primary"><%= group.categories[0] %></span>
                                    <% } %>
                                </div>
                            </div>
                            <div class="card__footer">
                                <a href="/groups/<%= group.slug %>" class="btn btn--tech">
                                    View Details
                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M8.636 3.5a.5.5 0 0 0-.5.5v2h-3a.5.5 0 0 0 0 1h3v2a.5.5 0 0 0 .854.353l2.5-2.5a.5.5 0 0 0 0-.707l-2.5-2.5A.5.5 0 0 0 8.636 3.5z"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <!-- No Results -->
                <div class="notification-card text-center">
                    <% if (typeof nearMe !== 'undefined' && nearMe) { %>
                        <h3>üìç No groups found near you</h3>
                        <p class="text-subtitle mb-4">We couldn't find any groups within 25km of your location. Try browsing all groups instead.</p>
                    <% } else if (typeof query !== 'undefined' && query) { %>
                        <h3>No groups found</h3>
                        <p class="text-subtitle mb-4">We couldn't find any groups matching "<%= query %>". Try different search terms.</p>
                    <% } else { %>
                        <h3>No groups available</h3>
                        <p class="text-subtitle mb-4">There are currently no groups in the directory.</p>
                    <% } %>
                    
                    <div class="flex gap-4 justify-center">
                        <a href="/" class="btn btn--tech">‚Üê Return Home</a>
                        <a href="/search" class="btn btn--outline">Browse All Groups</a>
                    </div>
                </div>
            <% } %>
        </section>
    </main>

    <%- include('partials/footer') %>
</body>
</html>